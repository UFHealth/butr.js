(function(f,B){typeof exports=="object"&&typeof module!="undefined"?module.exports=B():typeof define=="function"&&define.amd?define(B):(f=typeof globalThis!="undefined"?globalThis:f||self,f.Butr=B())})(this,(function(){"use strict";let f={animating:!1,topBuffer:0,bottomBuffer:0,settings:{}};const B=(t,l)=>{let s=null,r=performance.now();return()=>{r+l-performance.now()<0&&(t(),r=performance.now()),s&&clearTimeout(s),s=setTimeout(t,l)}},k=(t,l)=>{const s=t.className+(" "+l);t.className=s.trim()},x=t=>{const s=Object.assign({},{duration:800,loop:null,done:null,easing:"easeInOutQuad"},t);let r,m,i;const g=()=>{f.animating=!0,r=performance.now(),m=r+s.duration,c()},c=()=>{i=performance.now(),s.loop(h),i<m?requestAnimationFrame(c):(f.animating=!1,typeof s.done=="function"&&s.done())},h=(e,E)=>{const p=(E-e)*S[s.easing](C());return e+p},C=()=>Math.min((i-r)/s.duration,1),S={linear(e){return e},easeInQuad(e){return e*e},easeOutQuad(e){return e*(2-e)},easeInOutQuad(e){return e<.5?2*e*e:-1+(4-2*e)*e},easeInCubic(e){return e*e*e},easeOutCubic(e){return--e*e*e+1},easeInOutCubic(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart(e){return e*e*e*e},easeOutQuart(e){return 1- --e*e*e*e},easeInOutQuart(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint(e){return e*e*e*e*e},easeOutQuint(e){return 1+--e*e*e*e*e},easeInOutQuint(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};g()},I=t=>{const l={target:0,direction:"y",keepHash:!0,speed:1,afterTo:null,scrollOffset:f.settings.scrollOffset||0};t=Object.assign({},l,t);const s=window.matchMedia("(prefers-reduced-motion)").matches;let r,m,i;const g=()=>t&&t.scrollingElement?document.querySelector(t.scrollingElement):document.scrollingElement||document.documentElement,c=()=>t.direction==="x"?i.scrollLeft:i.scrollTop,h=()=>{if(t.target[0]==="#"){const d=document.getElementById(t.target.substr(1)),v=d.getBoundingClientRect();if(d&&t.direction==="x"){const y=i.scrollLeft;return Math.max(v.left+y-t.scrollOffset,0)}if(d&&t.direction==="y"){const y=i.scrollTop;return Math.max(v.top+y-t.scrollOffset,0)}return 0}return t.target},C=d=>{t.direction==="x"?i.scrollLeft=d:i.scrollTop=d},S=()=>{typeof t.afterTo=="function"&&t.afterTo()},e=d=>24*(1/t.speed)*Math.sqrt(Math.abs(d)),E=()=>{r=c(),m=h(),m===r?S():x({duration:e(m-r),loop(d){const v=d(r,m);C(v)},done:S})},u=()=>{t.keepHash&&t.target[0]==="#"&&history.pushState({},"",t.target)};(()=>{i=g(),s?C(h()):E(),u()})()},L=()=>{const{settings:t}=f;let l=window.matchMedia("(prefers-reduced-motion)").matches,s,r,m,i,g,c,h;const C=()=>{m=t.scrollingElement?document.querySelector(t.scrollingElement):document.scrollingElement||document.documentElement,h=document.querySelector(".js-butr-nav"),i=document.querySelectorAll(".js-butr-link"),g=document.querySelector(".js-butr-content"),c=[];for(var n=i.length-1;n>=0;n--)c.unshift(g.querySelector(i[n].getAttribute("href")))},S=()=>!h||!i||!g?(console.error("Error: Missing required classes on nav or links. Aborted setup of Butr.marker"),!1):!0,e=()=>{r=document.createElement("div"),r.classList.add("js-butr-marker"),t.markerClass&&k(r,t.markerClass),r.style.height=i[0].offsetHeight+"px";const n="cubic-bezier(0.455, 0.03, 0.515, 0.955)";l||(r.style.transition=[`${t.duration}ms transform ${n}`,`${t.duration}ms height ${n}`].join(",")),h.appendChild(r)},E=n=>{let o=n.offsetTop;window.getComputedStyle(n),r.style.transform=`translateY(${o}px)`,r.style.height=`${n.offsetHeight}px`},u=()=>{for(let n=0;n<i.length;n++)i[n].addEventListener("click",o=>{d(i[n].hash)})},p=()=>{let n;for(let o=0;o<c.length;o++){if(!c[o])continue;if(c[o].getBoundingClientRect().top+s-t.scrollOffset-2>s){n||(n=c[o]);break}else n=c[o]}n&&d("#"+n.id)},d=n=>{let o=document.querySelector(".js-butr-link.js-butr-active"),a=document.querySelector('.js-butr-link[href="'+n+'"]');a!==o&&(o&&(o.classList.remove("js-butr-active"),t.activeClass&&o.classList.remove(t.activeClass)),a&&(a.classList.add("js-butr-active"),t.activeClass&&k(a,t.activeClass),E(a)))},v=()=>{s=m.scrollTop,p()},y=B(()=>{f.animating||v()},33);(()=>{C(),S()&&(e(),u(),v(),window.addEventListener("scroll",y))})()},M=()=>{let t=document.body.querySelectorAll("a[data-butr]");if(!t.length)return!1;for(let l=0;l<t.length;l++)t[l].addEventListener("click",s=>{s.preventDefault(),I({target:s.currentTarget.getAttribute("href")})})},A=()=>{const{settings:t}=f;let l,s,r,m,i=[],g=[i],c=0;const h=n=>{let o=n.toLowerCase().replace(/\s+/g,"-").replace(/(\d)\./g,"$1-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,""),a=o,b=0;for(;document.getElementById(a);)a=o+"-"+ ++b;return a},C=n=>(n.id||(n.id=h(n.textContent)),"#"+n.id),S=()=>{r=document.querySelector(".js-butr-nav"),l=document.querySelector(".js-butr-content"),s=l.querySelectorAll(":is(h2, h3, h4, h5, h6):not([data-butr-ignore])")},e=()=>!r||!l||!s?(console.error("Error: Missing required classes on nav, content, or headings. Aborted setup of Butr.marker"),!1):!0,E=n=>parseInt(n.tagName.substr(1))-c,u=n=>s[n+1]?parseInt(s[n+1].tagName.substr(1))-c:0,p=n=>({label:n.textContent.trim(),hash:C(n),children:[]}),d=()=>{for(let n=0;n<s.length;n++){let o=s[n],a=E(o),b=u(n),w=p(o);if(m=g[g.length-1],m.push(w),b){if(b>a)c+=b-a-1,b-=c,g.push(w.children);else if(b<a){b+=c;for(let q=0;q<a-b;q++)g.pop();c=0}}}},v=n=>{let o=document.createElement("li"),a=document.createElement("a");return a.href=n.hash,a.setAttribute("data-butr",!0),a.innerText=n.label,a.classList.add("js-butr-link"),t.aClass&&k(a,t.aClass),t.liClass&&k(o,t.liClass),o.appendChild(a),o},y=n=>{let o=document.createElement("ol");t.olClass&&k(o,t.olClass);for(let a=0;a<n.length;a++){let b=n[a],w=v(b);b.children.length&&w.appendChild(y(b.children)),o.appendChild(w)}return o};(()=>{if(S(),e()){d();let n=y(i);t.prepend?r.insertBefore(n,r.firstElementChild):r.appendChild(n)}})()},j=()=>{const{settings:t}=f,l=document.querySelector(".js-butr-nav"),s=l.parentElement,r=window.getComputedStyle(s),m=parseInt(r.getPropertyValue("padding-top"),10),i=parseInt(r.getPropertyValue("padding-bottom"),10),g=()=>{const u=parseInt(r.getPropertyValue("padding-right"),10),p=parseInt(r.getPropertyValue("padding-left"),10),d=parseInt(r.getPropertyValue("width"),10);l.style.maxWidth=d-p-u+"px",l.style.width="100%"},c=()=>{const u=";position: fixed; top: "+(f.topBuffer+m)+"px; bottom: auto;";l.style.cssText+=u},h=()=>{const u=";position: absolute; top: auto; bottom: "+i+"px;";l.style.cssText+=u},C=()=>{let u=";position: relative; top: auto; bottom: auto;";l.style.cssText+=u},S=()=>{const u=document.querySelector(".js-butr-avoidAbove"),p=document.querySelector(".js-butr-avoidBelow");u&&(f.topBuffer=Math.round(u.getBoundingClientRect().bottom)),p&&(f.bottomBuffer=Math.round(p.getBoundingClientRect().top))},e=B(()=>{const u=getComputedStyle(l).position,p=l.getBoundingClientRect(),d=s.getBoundingClientRect(),v=Math.round(d.top),y=Math.round(d.bottom),T=Math.round(p.top),n=Math.round(p.bottom);u==="fixed"?v>f.topBuffer?C():y-i<n&&h():u==="absolute"?T>=f.topBuffer+m&&c():u==="relative"&&(y-i<l.offsetHeight+f.topBuffer+m?h():T-f.topBuffer-m<=0&&c())},33),E=()=>{g(),S(),e(),window.addEventListener("scroll",e),window.addEventListener("resize",e)};t.mediaQuery?matchMedia(t.mediaQuery).matches&&E():E()},O={olClass:"Butr__Sidebar__List",liClass:"Butr__Sidebar__Item",aClass:"Butr__Sidebar__Link",scrollingElement:null,duration:320,markerClass:"Butr__Marker",activeClass:"Butr__Sidebar__Link--active",mediaQuery:!1};return{init:t=>{f.settings=Object.assign({},O,t),t.AutoSidebar&&A(),t.AutoAnchors&&M(),t.Marker&&L(),t.StickyNav&&j()},to:I}}));
